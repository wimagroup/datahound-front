<div class="dashboard-container">
    <div class="header">
        <img [src]="darkMode ? 'assets/logo-dark.png' : 'assets/logo.png'" class="logo" alt="Logo" width="360" />
        <div class="actions">
            <button pButton type="button" [icon]="darkMode ? 'pi pi-sun' : 'pi pi-moon'" (click)="toggleTheme()"
                class="p-button-text p-button-plain p-mr-2" aria-label="Toggle Theme">
            </button>
            <button pButton type="button" icon="pi pi-sign-out" (click)="onLogout()"
                class="p-button-text p-button-plain" aria-label="Sair">
            </button>
        </div>

    </div>

    <h2 class="subtitle">Utilize os filtros abaixo para encontrar os melhores produtos</h2>

    <p-card styleClass="mb-3 small-text">
        <div class="p-fluid">
            <div class="flex flex-wrap gap-2">
                <div>
                    <input pInputText type="text" [(ngModel)]="name" placeholder="Nome do produto" />
                </div>

                <div>
                    <input pInputText type="number" [(ngModel)]="comissaoMin" placeholder="Comissão Min. USD/EUR" />
                </div>

                <div>
                    <input pInputText type="number" [(ngModel)]="comissaoMax" placeholder="Comissão Max. USD/EUR" />
                </div>

                <div>
                    <input pInputText type="number" [(ngModel)]="comissaoMinReais" placeholder="Comissão Min. R$" />
                </div>

                <div>
                    <input pInputText type="number" [(ngModel)]="comissaoMaxReais" placeholder="Comissão Max. R$" />
                </div>

                <div>
                    <input pInputText type="text" [ngModel]="formatNumber(trafegoMin)"
                        (ngModelChange)="trafegoMin = parseNumber($event)" placeholder="Tráfego Min." />
                </div>
                <div>
                    <input pInputText type="text" [ngModel]="formatNumber(trafegoMax)"
                        (ngModelChange)="trafegoMax = parseNumber($event)" placeholder="Tráfego Max." />
                </div>
                <div>
                    <p-multiSelect [options]="plataformas" [(ngModel)]="plataformasSelecionadas" optionLabel="label"
                        optionValue="value" defaultLabel="Todas as plataformas" placeholder="Selecione plataformas"
                        display="chip">
                    </p-multiSelect>
                </div>
                <div>
                    <p-dropdown [options]="moedas" [(ngModel)]="moedaSelecionada" optionLabel="label"
                        optionValue="value" placeholder="Todas as moedas">
                    </p-dropdown>
                </div>
                <div class="flex align-items-center">
                    <p-checkbox [(ngModel)]="ignorarTrafegoZerado" binary="true" inputId="trafegoZerado"></p-checkbox>
                    <label for="trafegoZerado" class="ml-2">Ignorar produtos com tráfego zerado</label>
                </div>
            </div>
            <div class="flex justify-content-end mt-3 gap-2">
                <button pButton label="Filtrar" icon="pi pi-filter" (click)="filter()" style="width: auto;"></button>
                <button pButton label="Limpar" icon="pi pi-times" (click)="clearFilters()" class="p-button-secondary"
                    style="width: auto;"></button>
            </div>
        </div>
    </p-card>

    <div class="flex justify-content-end align-items-center gap-3 mb-3">
        <button pButton [label]="visualizarFavoritos ? 'Todos os produtos' : 'Meus favoritos'" icon="pi pi-star"
            [class.p-button-warning]="visualizarFavoritos" class="p-button-sm" (click)="toggleVisualizarFavoritos()">
        </button>

        <p-dropdown [options]="pageSizeOptions" [(ngModel)]="pageSize" (onChange)="onPageSizeChange($event)"
            optionLabel="label" optionValue="value" styleClass="p-dropdown-sm">
        </p-dropdown>
    </div>


    <p-card header="Selecione os campos para visualização" styleClass="mb-3 small-text">
        <div class="flex flex-wrap gap-3">
            <div *ngFor="let col of columns" class="flex align-items-center">
                <p-checkbox [(ngModel)]="col.visible" binary="true" inputId="{{ col.field }}"></p-checkbox>
                <label for="{{ col.field }}" class="ml-2">{{ col.header }}</label>
            </div>
        </div>
    </p-card>

    <p-table [value]="products" [lazy]="true" [paginator]="true" [rows]="pageSize" [totalRecords]="totalElements"
        [loading]="loading" (onLazyLoad)="loadLazy($event)" [responsive]="true" [sortField]="sortField"
        [sortOrder]="sortOrder" emptyMessage="Nenhum dado encontrado" [scrollable]="true" scrollHeight="auto"
        [styleClass]="(darkMode ? 'dark-table ' : '') + 'compact-table'">

        <ng-template pTemplate="colgroup">
            <colgroup>
                <col />
                <col *ngFor="let col of selectedColumns" />
            </colgroup>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 40px;"></th>
                <th *ngFor="let col of selectedColumns">
                    <span style="display: inline-flex; align-items: center; gap: 0.25rem; cursor: pointer;"
                        (click)="sortBy(col.field)">
                        {{ col.header }}
                        <i class="pi" [ngClass]="{
                            'pi-sort-amount-up-alt': sortField === col.field && sortOrder === 1,
                            'pi-sort-amount-down': sortField === col.field && sortOrder === -1,
                            'pi-sort-alt': sortField !== col.field
                        }">
                        </i>
                    </span>
                </th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-product>
            <tr>
                <td style="text-align: center;">
                    <i class="pi" [ngClass]="product.favoritado ? 'pi-star-fill' : 'pi-star'"
                        [style.color]="product.favoritado ? '#facc15' : '#9ca3af'"
                        style="cursor: pointer; font-size: 1.2rem;" (click)="toggleFavorito(product)">
                    </i>
                </td>

                <td *ngFor="let col of selectedColumns">
                    <ng-container [ngSwitch]="col.field">
                        <a *ngSwitchCase="'paginaVendas'" [href]="product.paginaVendas" target="_blank">
                            Acessar
                        </a>
                        <span *ngSwitchCase="'comparacaoMesAnterior'"
                            [ngClass]="getComparisonClass(product.comparacaoMesAnterior)">
                            {{ product.comparacaoMesAnterior }}
                        </span>
                        <span *ngSwitchCase="'comparacaoPenultimoMes'"
                            [ngClass]="getComparisonClass(product.comparacaoPenultimoMes)">
                            {{ product.comparacaoPenultimoMes }}
                        </span>
                        <span *ngSwitchDefault>
                            {{ product[col.field] }}
                        </span>
                    </ng-container>
                </td>
            </tr>
        </ng-template>

    </p-table>


    <p-dialog [(visible)]="mostrarModalTermos" [modal]="true" [closable]="false" [dismissableMask]="false"
        [draggable]="false" [resizable]="false" [style]="{width: '90vw', maxWidth: '600px'}"
        contentStyle="max-height:70vh; overflow:auto;" [baseZIndex]="10000" [showHeader]="false"
        styleClass="custom-dialog-blur">

        <div class="p-fluid">
            <h2>Termos de Uso</h2>
            <p>
                O uso da plataforma DataHound implica na aceitação integral destes Termos de Uso. Ao acessar e utilizar
                nossos serviços, você concorda com as condições descritas abaixo:
            </p>
            <ol>
                <li><strong>Sigilo de Acesso:</strong> Você é responsável por manter a confidencialidade de seu login e
                    senha. O compartilhamento de credenciais com terceiros é estritamente proibido.</li>
                <li><strong>Proteção de Dados e LGPD:</strong> Seus dados pessoais são tratados com segurança e
                    confidencialidade, conforme a Lei Geral de Proteção de Dados (Lei nº 13.709/2018). Não
                    compartilhamos informações coletadas fora da plataforma sem sua autorização prévia, salvo por
                    obrigação legal.</li>
                <li><strong>Uso Permitido:</strong> Esta plataforma é destinada exclusivamente para fins profissionais
                    relacionados à análise e gestão de informações disponibilizadas. É proibida qualquer forma de
                    utilização que viole leis ou regulamentos vigentes.</li>
                <li><strong>Responsabilidades:</strong> O usuário compromete-se a utilizar a plataforma de forma ética e
                    responsável. A DataHound não se responsabiliza por eventuais prejuízos decorrentes do uso inadequado
                    dos serviços.</li>
                <li><strong>Aceite dos Termos:</strong> O uso da plataforma requer a leitura e aceitação destes termos.
                    O não aceite impossibilita a utilização dos serviços.</li>
            </ol>
            <div class="field-checkbox mt-3">
                <p-checkbox [(ngModel)]="aceitouTermos" [binary]="true" inputId="aceiteTermos">
                </p-checkbox>
                <label for="aceiteTermos">Declaro que li e aceito os Termos de Uso</label>
            </div>

            <button pButton label="Concordo" [disabled]="!aceitouTermos" (click)="confirmarAceiteTermos()"
                class="mt-3 w-full"></button>
        </div>
    </p-dialog>

    <p-dialog [(visible)]="mostrarModalPrimeiroAcesso" [modal]="true" [closable]="false" [dismissableMask]="false"
        [draggable]="false" [resizable]="false" [style]="{width: '90vw', maxWidth: '500px'}"
        contentStyle="max-height:70vh; overflow:auto;" [baseZIndex]="10000" [showHeader]="false"
        styleClass="custom-dialog-blur">

        <div class="p-fluid">
            <h2>Bem-vindo ao DataHound!</h2>
            <p>
                É muito bom ter você aqui. Este é seu primeiro acesso. Para manter sua conta segura, por favor altere
                sua senha.
            </p>

            <div class="field mt-3">
                <label for="novaSenha">Nova Senha</label>
                <input id="novaSenha" pInputText type="password" [(ngModel)]="novaSenha" />
            </div>

            <div class="field mt-2">
                <label for="confirmarSenha">Confirme a Senha</label>
                <input id="confirmarSenha" pInputText type="password" [(ngModel)]="confirmarSenha" />
            </div>

            <button pButton label="Alterar Senha" class="mt-3 w-full"
                [disabled]="!novaSenha || !confirmarSenha || novaSenha !== confirmarSenha"
                (click)="alterarSenhaPrimeiroAcesso()">
            </button>
        </div>
    </p-dialog>


</div>